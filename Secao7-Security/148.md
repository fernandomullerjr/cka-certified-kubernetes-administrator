
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
# push

git status
git add .
git commit -m "148. View Certificate Details."
eval $(ssh-agent -s)
ssh-add /home/fernando/.ssh/chave-debian10-github
git push
git status



------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
# 148. View Certificate Details

# View Certificate Details
  - Take me to [Video Tutorial](https://kodekloud.com/topic/view-certificate-details/)
  
In this section, we will take a look how to view certificates in a kubernetes cluster.

## View Certs 
 ![hrd](../../images/hrd.PNG)

 ![hrd1](../../images/hrd1.PNG)
 
 - To view the details of the certificate
   ```
   $ openssl x509 -in /etc/kubernetes/pki/apiserver.crt -text -noout
   ```
   
   ![hrd2](../../images/hrd2.PNG)
   
#### Follow the same procedure to identify information about of all the other certificates

   ![hrd3](../../images/hrd3.PNG)
   
## Inspect Server Logs - Hardware setup
- Inspect server logs using journalctl
  ```
  $ journalctl -u etcd.service -l
  ```
  
  ![hrd4](../../images/hrd4.PNG)
  
## Inspect Server Logs - kubeadm setup
- View logs using kubectl
  ```
  $ kubectl logs etcd-master
  ```
  ![hrd5](../../images/hrd5.PNG)
  
- View logs using docker ps and docker logs
  ```
  $ docker ps -a
  $ docker logs <container-id>
  ```
  ![hrd6](../../images/hrd6.PNG)
  
#### K8s Reference Docs
- https://kubernetes.io/docs/setup/best-practices/certificates/#certificate-paths
  
  

  

   
   





------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------
# 148. View Certificate Details

- To view the details of the certificate

~~~~bash
openssl x509 -in /etc/kubernetes/pki/apiserver.crt -text -noout
~~~~


- Follow the same procedure to identify information about of all the other certificates

   



## Inspect Server Logs - Hardware setup

- Inspect server logs using journalctl
~~~~bash
journalctl -u etcd.service -l
~~~~
  


  
## Inspect Server Logs - kubeadm setup

- View logs using kubectl

~~~~bash
kubectl logs etcd-master
~~~~



  
- View logs using docker ps and docker logs

~~~~bash
docker ps -a
docker logs <container-id>
~~~~



  
#### K8s Reference Docs
- https://kubernetes.io/docs/setup/best-practices/certificates/#certificate-paths
  
  







- Tentei consultar o kube-apiserver do Minikube, porém o Pod não tá com o Container operacional

~~~~bash

fernando@debian10x64:~$ kubectl get pods -n kube-system
NAME                               READY   STATUS    RESTARTS       AGE
coredns-78fcd69978-5xcpp           1/1     Running   45 (24m ago)   244d
etcd-minikube                      1/1     Running   58 (24m ago)   244d
kube-apiserver-minikube            0/1     Running   9 (24m ago)    138d
kube-controller-manager-minikube   1/1     Running   65 (24m ago)   244d
kube-proxy-5pc9k                   1/1     Running   45 (24m ago)   244d
kube-scheduler-minikube            1/1     Running   54 (24m ago)   244d
metrics-server-77c99ccb96-pnnwl    1/1     Running   39 (28d ago)   210d
my-scheduler-6c595b886d-87dms      1/1     Running   25 (24m ago)   215d
storage-provisioner                1/1     Running   96 (22m ago)   244d
fernando@debian10x64:~$
fernando@debian10x64:~$
fernando@debian10x64:~$
fernando@debian10x64:~$
fernando@debian10x64:~$
fernando@debian10x64:~$ kubectl describe pod kube-apiserver-minikube -n kube-system | tail
Events:
  Type     Reason          Age                     From     Message
  ----     ------          ----                    ----     -------
  Warning  Unhealthy       28d (x3556 over 29d)    kubelet  Readiness probe failed: HTTP probe failed with statuscode: 500
  Normal   SandboxChanged  23m                     kubelet  Pod sandbox changed, it will be killed and re-created.
  Normal   Pulled          23m                     kubelet  Container image "k8s.gcr.io/kube-apiserver:v1.22.2" already present on machine
  Normal   Created         23m                     kubelet  Created container kube-apiserver
  Normal   Started         23m                     kubelet  Started container kube-apiserver
  Warning  Unhealthy       23m                     kubelet  Startup probe failed: HTTP probe failed with statuscode: 403
  Warning  Unhealthy       3m28s (x1219 over 23m)  kubelet  Readiness probe failed: HTTP probe failed with statuscode: 500
fernando@debian10x64:~$

~~~~




- Logs do Pod do kube-apiserver:

~~~~bash

E0903 03:07:13.853462       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:14.857342       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:15.861114       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:16.865845       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:17.870541       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:18.876564       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:19.881186       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:20.886275       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:21.892463       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:22.906017       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:22.991535       1 status.go:71] apiserver received an error that is not an metav1.Status: 3: illegal base64 data at input byte 3
E0903 03:07:22.992482       1 reflector.go:138] k8s.io/client-go/informers/factory.go:134: Failed to watch *v1.Secret: failed to list *v1.Secret: illegal base64 data at input byte 3
E0903 03:07:23.911527       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:24.915953       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:25.920763       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:26.931890       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:27.940936       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:28.947989       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:29.954516       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:30.959193       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:31.967650       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:32.977136       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:33.981761       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:34.988165       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:35.992397       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:36.997642       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:38.001749       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:38.509094       1 status.go:71] apiserver received an error that is not an metav1.Status: 3: illegal base64 data at input byte 3
E0903 03:07:39.013951       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:40.026583       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:41.040839       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:42.054132       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:42.208735       1 status.go:71] apiserver received an error that is not an metav1.Status: 3: illegal base64 data at input byte 3
E0903 03:07:43.058921       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
E0903 03:07:44.062127       1 cacher.go:420] cacher (*core.Secret): unexpected ListAndWatch error: failed to list *core.Secret: illegal base64 data at input byte 3; reinitializing...
fernando@debian10x64:~$
fernando@debian10x64:~$
fernando@debian10x64:~$
fernando@debian10x64:~$ date
Sun 03 Sep 2023 12:07:48 AM -03
fernando@debian10x64:~$

fernando@debian10x64:~$ kubectl get secret -A
Error from server: illegal base64 data at input byte 3
fernando@debian10x64:~$
fernando@debian10x64:~$ date
Sun 03 Sep 2023 01:43:25 AM -03
fernando@debian10x64:~$

~~~~






## PENDENTE
- Resolver problema no Pod do kube-apiserver, para poder efetuar procedimento da aula 148 e verificar detalhes do certificado.
        Erro   no Pod do kube-apiserver parece ter relação com Secret.
