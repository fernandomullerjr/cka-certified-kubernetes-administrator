#
# ###################################################################################################################### 
# ###################################################################################################################### 
#  push

git status
git add .
git commit -m "272. Mock Exam - 2 - Solution."
eval $(ssh-agent -s)
ssh-add /home/fernando/.ssh/chave-debian10-github
git push
git status


# ###################################################################################################################### 
# ###################################################################################################################### 
## 272. Mock Exam - 2 - Solution

Revisando Mock Exam 2


# ###################################################################################################################### 
# ###################################################################################################################### 
## 1 / 8
ETCDCTL_API=3 etcdctl snapshot save /opt/etcd-backup.db --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key



Para chegar nesta resposta

Na prova **CKA (Certified Kubernetes Administrator)**, √© essencial saber como obter as informa√ß√µes necess√°rias para formar o comando de backup do etcd. Aqui est√° como voc√™ pode proceder:

---

### **1. Verificar os par√¢metros do `etcdctl`**
Antes de tudo, voc√™ precisa entender os par√¢metros usados no comando:

- **`ETCDCTL_API=3`**: Define a vers√£o da API que ser√° usada. A vers√£o 3 √© a recomendada para etcd moderno.
- **`--endpoints`**: O endere√ßo do endpoint etcd (geralmente `https://127.0.0.1:2379` em clusters locais).
- **`--cacert`**: Caminho para o certificado da Autoridade Certificadora (CA) que valida a comunica√ß√£o SSL/TLS.
- **`--cert` e `--key`**: Certificado e chave privada do etcd para autentica√ß√£o.

---

### **2. Como encontrar os valores necess√°rios**
#### a. **Endere√ßo do etcd (`--endpoints`)**
- Normalmente, o etcd √© configurado no arquivo `/etc/kubernetes/manifests/etcd.yaml`, que define o Pod est√°tico para o etcd. Use o comando abaixo para verificar:

  ```bash
  cat /etc/kubernetes/manifests/etcd.yaml
  ```

  Busque por algo como:

  ```yaml
  - --listen-client-urls=https://127.0.0.1:2379
  ```

  O valor ser√° o endpoint do etcd. Na maioria dos casos, √© `https://127.0.0.1:2379`.

---

#### b. **Caminhos para certificados e chaves**
Os certificados s√£o geralmente gerados pelo kubeadm e podem ser encontrados em:

```bash
ls /etc/kubernetes/pki/etcd/
```

Voc√™ ver√° arquivos como:
- `ca.crt` (CA do etcd)
- `server.crt` (Certificado do servidor)
- `server.key` (Chave privada do servidor)

Estes caminhos s√£o usados para os par√¢metros `--cacert`, `--cert` e `--key`:

```bash
--cacert=/etc/kubernetes/pki/etcd/ca.crt
--cert=/etc/kubernetes/pki/etcd/server.crt
--key=/etc/kubernetes/pki/etcd/server.key
```

---

#### c. **Verificar configura√ß√µes com `kubectl`**
Se voc√™ n√£o tem certeza das configura√ß√µes, use o `kubectl` para acessar os detalhes do Pod etcd:

```bash
kubectl -n kube-system describe pod etcd-<nome-do-node>
```

Procure por argumentos que indiquem o endpoint, certificados ou configura√ß√µes adicionais.

---

### **3. Montando o comando completo**
Com base nas informa√ß√µes encontradas, o comando ficar√° assim:

```bash
ETCDCTL_API=3 etcdctl snapshot save /opt/etcd-backup.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key
```

---

### **4. Testando o comando**
Sempre teste o comando antes de confiar no backup:

```bash
ETCDCTL_API=3 etcdctl snapshot status /opt/etcd-backup.db
```

Se o backup foi bem-sucedido, voc√™ ver√° informa√ß√µes como tamanho do arquivo e a revis√£o do etcd.

---

Caso encontre dificuldades durante a prova, priorize usar o `kubectl` para inspecionar os Pods e arquivos de configura√ß√£o em `/etc/kubernetes/manifests`. Boa sorte! üòä



Para descobrir as informa√ß√µes necess√°rias para formar este comando de backup do etcd no Kubernetes, voc√™ pode seguir estes passos:

1. Primeiro, conecte-se ao n√≥ master/control-plane do cluster onde o etcd est√° rodando usando:
```bash
ssh <node-name>
```

2. Para encontrar os caminhos dos certificados e chaves, voc√™ pode:
```bash
kubectl describe pod -n kube-system etcd-<master-node-name>
```
Ou verificar diretamente no diret√≥rio padr√£o:
```bash
ls -l /etc/kubernetes/pki/etcd/
```

3. Para confirmar o endpoint do etcd, voc√™ pode:
```bash
kubectl get pods -n kube-system | grep etcd
```
E depois verificar as configura√ß√µes:
```bash
docker ps | grep etcd
# ou
crictl ps | grep etcd
```

4. Voc√™ tamb√©m pode verificar as configura√ß√µes do etcd usando:
```bash
cat /etc/kubernetes/manifests/etcd.yaml
```

Este arquivo yaml geralmente cont√©m todas as informa√ß√µes necess√°rias, incluindo:
- Localiza√ß√£o dos certificados
- Endpoint do etcd
- Configura√ß√µes da API

Na prova CKA, estas informa√ß√µes geralmente est√£o dispon√≠veis no pr√≥prio ambiente de teste, e voc√™ pode usar estes comandos para encontr√°-las. O diret√≥rio `/etc/kubernetes/pki/etcd/` √© o local padr√£o para os certificados do etcd no Kubernetes.